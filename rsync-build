#!/usr/bin/env bash
set -e

echo "=== Antora Build Started: $(date) ==="

#
# 1. CLEAN PREVIOUS BUILD
#
echo "Cleaning previous build..."
rm -rf /home/kurt/antora-3compo-genealogy/public

#
# 2. UPDATE CONTENT REPOS
#
cd /home/kurt/antora-genealogy && git pull
cd /home/kurt/antora-immanuel && git pull
cd /home/kurt/antora-nla && git pull

#
# 3. RUN ANTORA BUILD
#
cd /home/kurt/antora-3compo-genealogy
npx antora antora-3compo-playbook.yml

#
# 4. COPY FONTS
#
cp /home/kurt/antora-3compo-genealogy/fonts/* \
   /home/kurt/antora-3compo-genealogy/public/_/font/

#
# 5. DEPLOY TO VPS
#
rsync -avz --delete \
  /home/kurt/antora-3compo-genealogy/public/ \
  kurt@hostwinds:/var/www/krueckeberg.org/docs/

echo "=== Antora Build Completed: $(date) ==="
